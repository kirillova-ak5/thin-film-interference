#ifndef __COLOR_TABLE_H_
#define __COLOR_TABLE_H_

#include "mthdef.h"
#include "COLOR.H"

namespace mth
{
    const int COLOR_MATCH_LAMBDA_START = 380;
    const int COLOR_MATCH_LAMBDA_END = 750;// 815;


    enum color_matching_func
    {
        COLOR_MATCH_X = 0,
        COLOR_MATCH_Y = 1,
        COLOR_MATCH_Z = 2
    };

    const double xyz[][3] = {

        /*380*/    { 0.001368000,    0.00003900000,  0.006450001    },
        /*81 */    { 0.001502050,    0.00004282640,  0.007083216    },
        /*82 */    { 0.001642328,    0.00004691460,  0.007745488    },
        /*83 */    { 0.001802382,    0.00005158960,  0.008501152    },
        /*84 */    { 0.001995757,    0.00005717640,  0.009414544    },
        /*385*/    { 0.002236000,    0.00006400000,  0.01054999     },
        /*86 */    { 0.002535385,    0.00007234421,  0.01196580     },
        /*87 */    { 0.002892603,    0.00008221224,  0.01365587     },
        /*88 */    { 0.003300829,    0.00009350816,  0.01558805     },
        /*89 */    { 0.003753236,    0.0001061361,   0.01773015     },
        /*390*/    { 0.004243000,    0.0001200000,   0.02005001     },
        /*91 */    { 0.004762389,    0.0001349840,   0.02251136     },
        /*92 */    { 0.005330048,    0.0001514920,   0.02520288     },
        /*93 */    { 0.005978712,    0.0001702080,   0.02827972     },
        /*94 */    { 0.006741117,    0.0001918160,   0.03189704     },
        /*395*/    { 0.007650000,    0.0002170000,   0.03621000     },
        /*96 */    { 0.008751373,    0.0002469067,   0.04143771     },
        /*97 */    { 0.01002888,     0.0002812400,   0.04750372     },
        /*98 */    { 0.01142170,     0.0003185200,   0.05411988     },
        /*99 */    { 0.01286901,     0.0003572667,   0.06099803     },
        /*400*/    { 0.01431000,     0.0003960000,   0.06785001     },
        /*01 */    { 0.01570443,     0.0004337147,   0.07448632     },
        /*02 */    { 0.01714744,     0.0004730240,   0.08136156     },
        /*03 */    { 0.01878122,     0.0005178760,   0.08915364     },
        /*04 */    { 0.02074801,     0.0005722187,   0.09854048     },
        /*405*/    { 0.02319000,     0.0006400000,   0.1102000      },
        /*06 */    { 0.02620736,     0.0007245600,   0.1246133      },
        /*07 */    { 0.02978248,     0.0008255000,   0.1417017      },
        /*08 */    { 0.03388092,     0.0009411600,   0.1613035      },
        /*09 */    { 0.03846824,     0.001069880,    0.1832568      },
        /*410*/    { 0.04351000,     0.001210000,    0.2074000      },
        /*11 */    { 0.04899560,     0.001362091,    0.2336921      },
        /*12 */    { 0.05502260,     0.001530752,    0.2626114      },
        /*13 */    { 0.06171880,     0.001720368,    0.2947746      },
        /*14 */    { 0.06921200,     0.001935323,    0.3307985      },
        /*415*/    { 0.07763000,     0.002180000,    0.3713000      },
        /*16 */    { 0.08695811,     0.002454800,    0.4162091      },
        /*17 */    { 0.09717672,     0.002764000,    0.4654642      },
        /*18 */    { 0.1084063,      0.003117800,    0.5196948      },
        /*19 */    { 0.1207612,      0.003526400,    0.5795303      },
        /*420*/    { 0.1343800,      0.004000000,    0.6456000      },
        /*21 */    { 0.1493582,      0.004546240,    0.7184838      },
        /*22 */    { 0.1653957,      0.005159320,    0.7967133      },
        /*23 */    { 0.1819831,      0.005829280,    0.8778459      },
        /*24 */    { 0.1986110,      0.006546160,    0.9594390      },
        /*425*/    { 0.2147700,      0.007300000,    1.0390501      },
        /*26 */    { 0.2301868,      0.008086507,    1.1153673      },
        /*27 */    { 0.2448797,      0.008908720,    1.1884971      },
        /*28 */    { 0.2587773,      0.009767680,    1.2581233      },
        /*29 */    { 0.2718079,      0.01066443,     1.3239296      },
        /*430*/    { 0.2839000,      0.01160000,     1.3856000      },
        /*31 */    { 0.2949438,      0.01257317,     1.4426352      },
        /*32 */    { 0.3048965,      0.01358272,     1.4948035      },
        /*33 */    { 0.3137873,      0.01462968,     1.5421903      },
        /*34 */    { 0.3216454,      0.01571509,     1.5848807      },
        /*435*/    { 0.3285000,      0.01684000,     1.6229600      },
        /*36 */    { 0.3343513,      0.01800736,     1.6564048      },
        /*37 */    { 0.3392101,      0.01921448,     1.6852959      },
        /*38 */    { 0.3431213,      0.02045392,     1.7098745      },
        /*39 */    { 0.3461296,      0.02171824,     1.7303821      },
        /*440*/    { 0.3482800,      0.02300000,     1.7470600      },
        /*41 */    { 0.3495999,      0.02429461,     1.7600446      },
        /*42 */    { 0.3501474,      0.02561024,     1.7696233      },
        /*43 */    { 0.3500130,      0.02695857,     1.7762637      },
        /*44 */    { 0.3492870,      0.02835125,     1.7804334      },
        /*445*/    { 0.3480600,      0.02980000,     1.7826000      },
        /*46 */    { 0.3463733,      0.03131083,     1.7829682      },
        /*47 */    { 0.3442624,      0.03288368,     1.7816998      },
        /*48 */    { 0.3418088,      0.03452112,     1.7791982      },
        /*49 */    { 0.3390941,      0.03622571,     1.7758671      },
        /*450*/    { 0.3362000,      0.03800000,     1.7721100      },
        /*51 */    { 0.3331977,      0.03984667,     1.7682589      },
        /*52 */    { 0.3300411,      0.04176800,     1.7640390      },
        /*53 */    { 0.3266357,      0.04376600,     1.7589438      },
        /*54 */    { 0.3228868,      0.04584267,     1.7524663      },
        /*455*/    { 0.3187000,      0.04800000,     1.7441000      },
        /*56 */    { 0.3140251,      0.05024368,     1.7335595      },
        /*57 */    { 0.3088840,      0.05257304,     1.7208581      },
        /*58 */    { 0.3032904,      0.05498056,     1.7059369      },
        /*59 */    { 0.2972579,      0.05745872,     1.6887372      },
        /*460*/    { 0.2908000,      0.06000000,     1.6692000      },
        /*61 */    { 0.2839701,      0.06260197,     1.6475287      },
        /*62 */    { 0.2767214,      0.06527752,     1.6234127      },
        /*63 */    { 0.2689178,      0.06804208,     1.5960223      },
        /*64 */    { 0.2604227,      0.07091109,     1.5645280      },
        /*465*/    { 0.2511000,      0.07390000,     1.5281000      },
        /*66 */    { 0.2408475,      0.07701600,     1.4861114      },
        /*67 */    { 0.2298512,      0.08026640,     1.4395215      },
        /*68 */    { 0.2184072,      0.08366680,     1.3898799      },
        /*69 */    { 0.2068115,      0.08723280,     1.3387362      },
        /*470*/    { 0.1953600,      0.09098000,     1.2876400      },
        /*71 */    { 0.1842136,      0.09491755,     1.2374223      },
        /*72 */    { 0.1133273,      0.09904584,     1.1878243      },
        /*73 */    { 0.1626881,      0.1033674,      1.1387611      },
        /*74 */    { 0.1522833,      0.1078846,      1.0901480      },
        /*475*/    { 0.1421000,      0.1126000,      1.0419000      },
        /*76 */    { 0.1321786,      0.1175320,      0.9941976      },
        /*77 */    { 0.1225696,      0.1226744,      0.9473473      },
        /*78 */    { 0.1132752,      0.1279928,      0.9014531      },
        /*19 */    { 0.1042979,      0.1334528,      0.8566193      },
        /*480*/    { 0.09564000,     0.1390200,      0.8129501      },
        /*81 */    { 0.08729955,     0.1446764,      0.7705173      },
        /*82 */    { 0.07930804,     0.1504693,      0.7294448      },
        /*83 */    { 0.07171776,     0.1564619,      0.6899136      },
        /*84 */    { 0.06458099,     0.1627117,      0.6521049      },
        /*485*/    { 0.05795001,     0.1693000,      0.6162000      },
        /*86 */    { 0.05186211,     0.1762431,      0.5823286      },
        /*87 */    { 0.04628152,     0.1835581,      0.5504162      },
        /*88 */    { 0.04115088,     0.1912735,      0.5203376      },
        /*89 */    { 0.03641283,     0.1994180,      0.4919673      },
        /*490*/    { 0.03201000,     0.2080200,      0.4651800      },
        /*91 */    { 0.02791720,     0.2171199,      0.4399246      },
        /*92 */    { 0.02414440,     0.2267345,      0.4161836      },
        /*93 */    { 0.02068700,     0.2368571,      0.3938822      },
        /*94 */    { 0.01754040,     0.2474812,      0.3729459      },
        /*495*/    { 0.01470000,     0.2586000,      0.3533000      },
        /*96 */    { 0.01216179,     0.2701849,      0.3348578      },
        /*97 */    { 0.009919960,    0.2822939,      0.3175521      },
        /*98 */    { 0.007967240,    0.2950505,      0.3013375      },
        /*99 */    { 0.006296346,    0.3085780,      0.2861686      },
        /*500*/    { 0.004900000,    0.3230000,      0.2720000      },
        /*01 */    { 0.003777173,    0.3384021,      0.2588171      },
        /*02 */    { 0.002945320,    0.3546858,      0.2464838      },
        /*03 */    { 0.002424880,    0.3716986,      0.2347718      },
        /*04 */    { 0.002236293,    0.3892875,      0.2234533      },
        /*505*/    { 0.002400000,    0.4073000,      0.2123000      },
        /*06 */    { 0.002925520,    0.4256299,      0.2011692      },
        /*07 */    { 0.003836560,    0.4443096,      0.1901196      },
        /*08 */    { 0.005174840,    0.4633944,      0.1792254      },
        /*09 */    { 0.006982080,    0.4829395,      0.1685608      },
        /*510*/    { 0.009300000,    0.5030000,      0.1582000      },
        /*11 */    { 0.01214949,     0.5235693,      0.1481383      },
        /*12 */    { 0.01553588,     0.5445120,      0.1383758      },
        /*13 */    { 0.01947752,     0.5656900,      0.1289942      },
        /*14 */    { 0.02399277,     0.5869653,      0.1200751      },
        /*515*/    { 0.02910000,     0.6082000,      0.1117000      },
        /*16 */    { 0.03481485,     0.6293456,      0.1039048      },
        /*17 */    { 0.04112016,     0.6503068,      0.09666748     },
        /*18 */    { 0.04798504,     0.6708752,      0.08998272     },
        /*19 */    { 0.05537861,     0.6908424,      0.08384531     },
        /*520*/    { 0.06327000,     0.7100000,      0.07824999     },
        /*21 */    { 0.07163501,     0.7281852,      0.07320899     },
        /*22 */    { 0.08046224,     0.7454636,      0.06867816     },
        /*23 */    { 0.08973996,     0.7619694,      0.06456784     },
        /*24 */    { 0.09945645,     0.7778368,      0.06078835     },
        /*525*/    { 0.1096000,      0.7932000,      0.05725001     },
        /*26 */    { 0.1201674,      0.8081104,      0.05390435     },
        /*27 */    { 0.1311145,      0.8224962,      0.05074664     },
        /*28 */    { 0.1423679,      0.8363068,      0.04775276     },
        /*29 */    { 0.1538542,      0.8494916,      0.04489859     },
        /*530*/    { 0.1655000,      0.8620000,      0.04216000     },
        /*31 */    { 0.1772571,      0.8738108,      0.03950728     },
        /*32 */    { 0.1891400,      0.8849624,      0.03693564     },
        /*33 */    { 0.2011694,      0.8954936,      0.03445836     },
        /*34 */    { 0.2133658,      0.9054432,      0.03208872     },
        /*535*/    { 0.2257499,      0.9148501,      0.02984000     },
        /*36 */    { 0.2383209,      0.9237348,      0.02771181     },
        /*37 */    { 0.2510668,      0.9320924,      0.02569444     },
        /*38 */    { 0.2639922,      0.9399226,      0.02378716     },
        /*39 */    { 0.2771017,      0.9472252,      0.02198925     },
        /*540*/    { 0.2904000,      0.9540000,      0.02030000     },
        /*41 */    { 0.3038912,      0.9602561,      0.01871805     },
        /*42 */    { 0.3175726,      0.9660074,      0.01724036     },
        /*43 */    { 0.3314384,      0.9712606,      0.01586364     },
        /*44 */    { 0.3454828,      0.9760225,      0.01458461     },
        /*545*/    { 0.3597000,      0.9803000,      0.01340000     },
        /*46 */    { 0.3740839,      0.9840924,      0.01230723     },
        /*47 */    { 0.3886396,      0.9874182,      0.01130188     },
        /*48 */    { 0.4033784,      0.9903128,      0.01037792     },
        /*49 */    { 0.4183115,      0.9928116,      0.009529306    },
        /*550*/    { 0.4334499,      0.9949501,      0.008749999    },
        /*51 */    { 0.4487953,      0.9967108,      0.008035200    },
        /*52 */    { 0.4643360,      0.9980983,      0.007381600    },
        /*53 */    { 0.4800640,      0.9991120,      0.006785400    },
        /*54 */    { 0.4959713,      0.9997482,      0.006242800    },
        /*555*/    { 0.5120501,      1.0000000,      0.005749999    },
        /*56 */    { 0.5282959,      0.9998567,      0.005303600    },
        /*57 */    { 0.5446916,      0.9993046,      0.004899800    },
        /*58 */    { 0.5612094,      0.9983255,      0.004534200    },
        /*59 */    { 0.5778215,      0.9968987,      0.004202400    },
        /*560*/    { 0.5945000,      0.9950000,      0.003900000    },
        /*61 */    { 0.6112209,      0.9926005,      0.003623200    },
        /*62 */    { 0.6279758,      0.9897426,      0.003370600    },
        /*63 */    { 0.6447602,      0.9864444,      0.003141400    },
        /*64 */    { 0.6615697,      0.9827241,      0.002934800    },
        /*565*/    { 0.6784000,      0.9786000,      0.002749999    },
        /*66 */    { 0.6952392,      0.9740837,      0.002585200    },
        /*67 */    { 0.7120586,      0.9691712,      0.002438600    },
        /*68 */    { 0.7288284,      0.9638568,      0.002309400    },
        /*69 */    { 0.7455188,      0.9581349,      0.002196800    },
        /*570*/    { 0.7621000,      0.9520000,      0.002100000    },
        /*71 */    { 0.7785432,      0.9454504,      0.002017733    },
        /*72 */    { 0.7948256,      0.9384992,      0.001948200    },
        /*73 */    { 0.8109264,      0.9311628,      0.001889800    },
        /*74 */    { 0.8268248,      0.9234576,      0.001840933    },
        /*575*/    { 0.8425000,      0.9154000,      0.001800000    },
        /*76 */    { 0.8579325,      0.9070064,      0.001766267    },
        /*77 */    { 0.8730816,      0.8982772,      0.001737800    },
        /*78 */    { 0.8878944,      0.8892048,      0.001711200    },
        /*79 */    { 0.9023181,      0.8797816,      0.001683067    },
        /*580*/    { 0.9163000,      0.8700000,      0.001650001    },
        /*81 */    { 0.9297995,      0.8598613,      0.001610133    },
        /*82 */    { 0.9427984,      0.8493920,      0.001564400    },
        /*83 */    { 0.9552776,      0.8386220,      0.001513600    },
        /*84 */    { 0.9672179,      0.8275813,      0.001458533    },
        /*585*/    { 0.9786000,      0.8163000,      0.001400000    },
        /*86 */    { 0.9893856,      0.8047947,      0.001336667    },
        /*87 */    { 0.9995488,      0.7930820,      0.001270000    },
        /*88 */    { 1.0090892,      0.7811920,      0.001205000    },
        /*89 */    { 1.0180064,      0.7691547,      0.001146667    },
        /*590*/    { 1.0263000,      0.7570000,      0.001100000    },
        /*91 */    { 1.0339827,      0.7447541,      0.001068800    },
        /*92 */    { 1.0409860,      0.7324224,      0.001049400    },
        /*93 */    { 1.0471880,      0.7200036,      0.001035600    },
        /*94 */    { 1.0524667,      0.7074965,      0.001021200    },
        /*595*/    { 1.0567000,      0.6949000,      0.001000000    },
        /*96 */    { 1.0597944,      0.6822192,      0.0009686400   },
        /*97 */    { 1.0617992,      0.6694716,      0.0009299200   },
        /*98 */    { 1.0628068,      0.6566744,      0.0008868800   },
        /*99 */    { 1.0629096,      0.6438448,      0.0008425600   },
        /*600*/    { 1.0622000,      0.6310000,      0.0008000000   },
        /*1  */    { 1.0607352,      0.6181555,      0.0007609600   },
        /*2  */    { 1.0584436,      0.6053144,      0.0007236800   },
        /*3  */    { 1.0552244,      0.5924756,      0.0006859200   },
        /*4  */    { 1.0509768,      0.5796379,      0.0006454400   },
        /*605*/    { 1.0456000,      0.5668000,      0.0006000000   },
        /*6  */    { 1.0390369,      0.5539611,      0.0005478667   },
        /*7  */    { 1.0313608,      0.5411372,      0.0004916000   },
        /*8  */    { 1.0226662,      0.5283528,      0.0004354000   },
        /*9  */    { 1.0130477,      0.5156323,      0.0003834667   },
        /*610*/    { 1.0026000,      0.5030000,      0.0003400000   },
        /*11 */    { 0.9913675,      0.4904688,      0.0003072533   },
        /*12 */    { 0.9793314,      0.4780304,      0.0002831600   },
        /*13 */    { 0.9664916,      0.4656776,      0.0002654400   },
        /*14 */    { 0.9528479,      0.4534032,      0.0002518133   },
        /*615*/    { 0.9384000,      0.4412000,      0.0002400000   },
        /*16 */    { 0.9231940,      0.4290800,      0.0002295467   },
        /*17 */    { 0.9072440,      0.4170360,      0.0002206400   },
        /*18 */    { 0.8905020,      0.4050320,      0.0002119600   },
        /*19 */    { 0.8729200,      0.3930320,      0.0002021867   },
        /*620*/    { 0.8544499,      0.3810000,      0.0001900000   },
        /*21 */    { 0.8350840,      0.3689184,      0.0001742133   },
        /*22 */    { 0.8149460,      0.3568272,      0.0001556400   },
        /*23 */    { 0.7941860,      0.3447768,      0.0001359600   },
        /*24 */    { 0.7729540,      0.3328176,      0.0001168533   },
        /*625*/    { 0.7514000,      0.3210000,      0.0001000000   },
        /*26 */    { 0.7295836,      0.3093381,      0.00008613333  },
        /*27 */    { 0.7075888,      0.2978504,      0.00007460000  },
        /*28 */    { 0.6856022,      0.2865936,      0.00006500000  },
        /*29 */    { 0.6638104,      0.2756245,      0.00005693333  },
        /*630*/    { 0.6424000,      0.2650000,      0.00004999999  },
        /*31 */    { 0.6215149,      0.2547632,      0.00004416000  },
        /*32 */    { 0.6011138,      0.2448896,      0.00003948000  },
        /*33 */    { 0.5811052,      0.2353344,      0.00003572000  },
        /*34 */    { 0.5613977,      0.2260528,      0.00003264000  },
        /*635*/    { 0.5419000,      0.2170000,      0.00003000000  },
        /*36 */    { 0.5225995,      0.2081616,      0.00002765333  },
        /*37 */    { 0.5035464,      0.1995488,      0.00002556000  },
        /*38 */    { 0.4847436,      0.1911552,      0.00002364000  },
        /*39 */    { 0.4661939,      0.1829744,      0.00002181333  },
        /*640*/    { 0.4479000,      0.1750000,      0.00002000000  },
        /*41 */    { 0.4298613,      0.1672235,      0.00001813333  },
        /*42 */    { 0.4120980,      0.1596464,      0.00001620000  },
        /*43 */    { 0.3946440,      0.1522776,      0.00001420000  },
        /*44 */    { 0.3775333,      0.1451259,      0.00001213333  },
        /*645*/    { 0.3608000,      0.1382000,      0.00001000000  },
        /*46 */    { 0.3444563,      0.1315003,      0.000007733333 },
        /*47 */    { 0.3285168,      0.1250248,      0.000005400000 },
        /*48 */    { 0.3130192,      0.1187792,      0.000003200000 },
        /*49 */    { 0.2980011,      0.1127691,      0.000001333333 },
        /*650*/    { 0.2835000,      0.1070000,      0.000000000000 },
        /*51 */    { 0.2695448,      0.1014762,      0.0            },
        /*52 */    { 0.2561184,      0.09618864,     0.0            },
        /*53 */    { 0.2431896,      0.09112296,     0.0            },
        /*54 */    { 0.2307272,      0.08626485,     0.0            },
        /*655*/    { 0.2187000,      0.08160000,     0.0            },
        /*56 */    { 0.2070971,      0.07712064,     0.0            },
        /*57 */    { 0.1959232,      0.07282552,     0.0            },
        /*58 */    { 0.1851708,      0.06871008,     0.0            },
        /*59 */    { 0.1748323,      0.06476976,     0.0            },
        /*660*/    { 0.1649000,      0.06100000,     0.0            },
        /*61 */    { 0.1553667,      0.05739621,     0.0            },
        /*62 */    { 0.1462300,      0.05395504,     0.0            },
        /*63 */    { 0.1374900,      0.05067376,     0.0            },
        /*64 */    { 0.1291467,      0.04754965,     0.0            },
        /*665*/    { 0.1212000,      0.04458000,     0.0            },
        /*66 */    { 0.1136397,      0.04175872,     0.0            },
        /*67 */    { 0.1064650,      0.03908496,     0.0            },
        /*68 */    { 0.09969044,     0.03656384,     0.0            },
        /*69 */    { 0.09333061,     0.03420048,     0.0            },
        /*670*/    { 0.08740000,     0.03200000,     0.0            },
        /*71 */    { 0.08190096,     0.02996261,     0.0            },
        /*72 */    { 0.07680428,     0.02807664,     0.0            },
        /*73 */    { 0.07207712,     0.02632936,     0.0            },
        /*74 */    { 0.06768664,     0.02470805,     0.0            },
        /*675*/    { 0.06360000,     0.02320000,     0.0            },
        /*76 */    { 0.05980685,     0.02180077,     0.0            },
        /*77 */    { 0.05628216,     0.02050112,     0.0            },
        /*78 */    { 0.05297104,     0.01928108,     0.0            },
        /*79 */    { 0.04981861,     0.01812069,     0.0            },
        /*680*/    { 0.04677000,     0.01700000,     0.0            },
        /*81 */    { 0.04378405,     0.01590379,     0.0            },
        /*82 */    { 0.04087536,     0.01483718,     0.0            },
        /*83 */    { 0.03807264,     0.01381068,     0.0            },
        /*84 */    { 0.03540461,     0.01283478,     0.0            },
        /*685*/    { 0.03290000,     0.01192000,     0.0            },
        /*86 */    { 0.03056419,     0.01106831,     0.0            },
        /*87 */    { 0.02838056,     0.01027339,     0.0            },
        /*88 */    { 0.02634484,     0.009533311,    0.0            },
        /*89 */    { 0.02445275,     0.008846157,    0.0            },
        /*690*/    { 0.02270000,     0.008210000,    0.0            },
        /*91 */    { 0.02108429,     0.007623781,    0.0            },
        /*92 */    { 0.01959988,     0.007085424,    0.0            },
        /*93 */    { 0.01823732,     0.006591476,    0.0            },
        /*94 */    { 0.01698717,     0.006138485,    0.0            },
        /*695*/    { 0.01584000,     0.005723000,    0.0            },
        /*96 */    { 0.01479064,     0.005341059,    0.0            },
        /*97 */    { 0.01383132,     0.004995796,    0.0            },
        /*98 */    { 0.01294868,     0.004676404,    0.0            },
        /*99 */    { 0.01212920,     0.004380075,    0.0            },
        /*700*/    { 0.01135916,     0.004102000,    0.0            },
        /*01 */    { 0.01062935,     0.003838453,    0.0            },
        /*02 */    { 0.009938846,    0.003589099,    0.0            },
        /*03 */    { 0.009288422,    0.003354219,    0.0            },
        /*04 */    { 0.008678854,    0.003134093,    0.0            },
        /*705*/    { 0.008110916,    0.002929000,    0.0            },
        /*6  */    { 0.007582388,    0.002738139,    0.0            },
        /*7  */    { 0.007088746,    0.002559876,    0.0            },
        /*8  */    { 0.006627313,    0.002393244,    0.0            },
        /*9  */    { 0.006195408,    0.002237275,    0.0            },
        /*710*/    { 0.005790346,    0.002091000,    0.0            },
        /*11 */    { 0.005409826,    0.001953587,    0.0            },
        /*12 */    { 0.005052583,    0.001824580,    0.0            },
        /*13 */    { 0.004717512,    0.001703580,    0.0            },
        /*14 */    { 0.004403507,    0.001590187,    0.0            },
        /*715*/    { 0.004109457,    0.001484000,    0.0            },
        /*16 */    { 0.003833913,    0.001384496,    0.0            },
        /*17 */    { 0.003575748,    0.001291268,    0.0            },
        /*18 */    { 0.003334342,    0.001204092,    0.0            },
        /*19 */    { 0.003109075,    0.001122744,    0.0            },
        /*720*/    { 0.002899327,    0.001047000,    0.0            },
        /*21 */    { 0.002704148,    0.0009765896,   0.0            },
        /*22 */    { 0.002523020,    0.0009111088,   0.0            },
        /*23 */    { 0.002354168,    0.0008501332,   0.0            },
        /*24 */    { 0.002196616,    0.0007932384,   0.0            },
        /*725*/    { 0.002049190,    0.0007400000,   0.0            },
        /*26 */    { 0.001910960,    0.0006900827,   0.0            },
        /*27 */    { 0.001781438,    0.0006433100,   0.0            },
        /*28 */    { 0.001660110,    0.0005994960,   0.0            },
        /*29 */    { 0.001546459,    0.0005584547,   0.0            },
        /*730*/    { 0.001439971,    0.0005200000,   0.0            },
        /*31 */    { 0.001340042,    0.0004839136,   0.0            },
        /*32 */    { 0.001246275,    0.0004500528,   0.0            },
        /*33 */    { 0.001158471,    0.0004183452,   0.0            },
        /*34 */    { 0.001076430,    0.0003887184,   0.0            },
        /*735*/    { 0.0009999493,   0.0003611000,   0.0            },
        /*36 */    { 0.0009287358,   0.0003353835,   0.0            },
        /*37 */    { 0.0008624332,   0.0003114404,   0.0            },
        /*38 */    { 0.0008007503,   0.0002891656,   0.0            },
        /*39 */    { 0.0007433960,   0.0002684539,   0.0            },
        /*740*/    { 0.0006900786,   0.0002492000,   0.0            },
        /*41 */    { 0.0006405156,   0.0002313019,   0.0            },
        /*42 */    { 0.0005945021,   0.0002146856,   0.0            },
        /*43 */    { 0.0005518646,   0.0001992884,   0.0            },
        /*44 */    { 0.0005124290,   0.0001850475,   0.0            },
        /*745*/    { 0.0004760213,   0.0001719000,   0.0            },
        /*46 */    { 0.0004424536,   0.0001597781,   0.0            },
        /*47 */    { 0.0004115117,   0.0001486044,   0.0            },
        /*48 */    { 0.0003829814,   0.0001383016,   0.0            },
        /*49 */    { 0.0003566491,   0.0001287925,   0.0            },
        /*750*/    { 0.0003323011,   0.0001200000,   0.0            },
        /*51 */    { 0.0003097586,   0.0001118595,   0.0            },
        /*52 */    { 0.0002888871,   0.0001043224,   0.0            },
        /*53 */    { 0.0002695394,   0.00009733560,  0.0            },
        /*54 */    { 0.0002515682,   0.00009084587,  0.0            },
        /*755*/    { 0.0002348261,   0.00008480000,  0.0            },
        /*56 */    { 0.0002191710,   0.00007914667,  0.0            },
        /*57 */    { 0.0002045258,   0.00007385800,  0.0            },
        /*58 */    { 0.0001908405,   0.00006891600,  0.0            },
        /*59 */    { 0.0001780654,   0.00006430267,  0.0            },
        /*760*/    { 0.0001661505,   0.00006000000,  0.0            },
        /*61 */    { 0.0001550236,   0.00005598187,  0.0            },
        /*62 */    { 0.0001446219,   0.00005222560,  0.0            },
        /*63 */    { 0.0001349098,   0.00004871840,  0.0            },
        /*64 */    { 0.0001258520,   0.00004544747,  0.0            },
        /*765*/    { 0.0001174130,   0.00004240000,  0.0            },
        /*66 */    { 0.0001095515,   0.00003956104,  0.0            },
        /*67 */    { 0.0001022245,   0.00003691512,  0.0            },
        /*68 */    { 0.00009539445,  0.00003444868,  0.0            },
        /*69 */    { 0.00008902390,  0.00003214816,  0.0            },
        /*770*/    { 0.00008307527,  0.00003000000,  0.0            },
        /*71 */    { 0.00007751269,  0.00002799125,  0.0            },
        /*72 */    { 0.00007231304,  0.00002611356,  0.0            },
        /*73 */    { 0.00006745778,  0.00002436024,  0.0            },
        /*74 */    { 0.00006292844,  0.00002272461,  0.0            },
        /*775*/    { 0.00005870652,  0.00002120000,  0.0            },
        /*76 */    { 0.00005477028,  0.00001977855,  0.0            },
        /*77 */    { 0.00005109918,  0.00001845285,  0.0            },
        /*78 */    { 0.00004767654,  0.00001721687,  0.0            },
        /*79 */    { 0.00004448567,  0.00001606459,  0.0            },
        /*780*/    { 0.00004150994,  0.00001499000,  0.0            },
        /*81 */    { 0.00003873324,  0.00001398728,  0.0            },
        /*82 */    { 0.00003614203,  0.00001305155,  0.0            },
        /*83 */    { 0.00003372352,  0.00001217818,  0.0            },
        /*84 */    { 0.00003146487,  0.00001136254,  0.0            },
        /*785*/    { 0.00002935326,  0.00001060000,  0.0            },
        /*86 */    { 0.00002737573,  0.000009885877, 0.0            },
        /*87 */    { 0.00002552433,  0.000009217304, 0.0            },
        /*88 */    { 0.00002379376,  0.000008592362, 0.0            },
        /*89 */    { 0.00002217870,  0.000008009133, 0.0            },
        /*790*/    { 0.00002067383,  0.000007465700, 0.0            },
        /*91 */    { 0.00001927226,  0.000006959567, 0.0            },
        /*92 */    { 0.00001796640,  0.000006487995, 0.0            },
        /*93 */    { 0.00001674991,  0.000006048699, 0.0            },
        /*94 */    { 0.00001561648,  0.000005639396, 0.0            },
        /*795*/    { 0.00001455977,  0.000005257800, 0.0            },
        /*96 */    { 0.00001357387,  0.000004901771, 0.0            },
        /*97 */    { 0.00001265436,  0.000004569720, 0.0            },
        /*98 */    { 0.00001179723,  0.000004260194, 0.0            },
        /*99 */    { 0.00001099844,  0.000003971739, 0.0            },
        /*800*/    { 0.00001025398,  0.000003702900, 0.0            },
        /*01 */    { 0.000009559646, 0.000003452163, 0.0            },
        /*02 */    { 0.000008912044, 0.000003218302, 0.0            },
        /*03 */    { 0.000008308358, 0.000003000300, 0.0            },
        /*04 */    { 0.000007745769, 0.000002797139, 0.0            },
        /*805*/    { 0.000007221456, 0.000002607800, 0.0            },
        /*06 */    { 0.000006732475, 0.000002431220, 0.0            },
        /*07 */    { 0.000006276423, 0.000002266531, 0.0            },
        /*08 */    { 0.000005851304, 0.000002113013, 0.0            },
        /*09 */    { 0.000005455118, 0.000001969943, 0.0            },
        /*810*/    { 0.000005085868, 0.000001836600, 0.0            },
        /*11 */    { 0.000004741466, 0.000001712230, 0.0            },
        /*12 */    { 0.000004420236, 0.000001596228, 0.0            },
        /*13 */    { 0.000004120783, 0.000001488090, 0.0            },
        /*14 */    { 0.000003841716, 0.000001387314, 0.0            },
        /*815*/    { 0.000003581652, 0.000001293400, 0.0            }

    };


    double x(double lambda);
    double y(double lambda);
    double z(double lambda);


    const double XYZ_TO_ADOBE_RGB[][3] = 
    {
        {2.0413690, -0.5649464, -0.3446944},
        {-0.9692660, 1.8760108, 0.0415560},
        {0.0134474, -0.1183897, 1.0154096}
    };

    const double ADOBE_RGB_TO_XYZ[][3] =
    {
        {0.5767309, 0.1855540, 0.1881852},
        {0.2973769, 0.6273491, 0.0752741},
        {0.0270343, 0.0706872, 0.9911085}
    };

    const double MODEL_RGB_WAVELENGTH2[] =//bgr actually
    {
        435.8,
        546.1,
        700.0
    };

    const double MODEL_RGB_WAVELENGTH3[] =//bgr actually
    {
        435.0,
        532.0,
        630.0
    };

    const double MODEL_RGB_WAVELENGTH[] =//bgr actually
    {
        425.0,
        532.0,
        640.0
    };

    template <class type>
    color<type> color<type>::FromIntensities(double *intensities, double *lambdas, int numOfIntensities)
    {
        double X = 0, Y = 0, Z = 0;

        for (int i = 0; i < numOfIntensities; i++)
        {
            double dl;
            if (lambdas[i] < COLOR_MATCH_LAMBDA_START || lambdas[i] > COLOR_MATCH_LAMBDA_END)
                continue;
            if (i == 0)
                dl = lambdas[0] - COLOR_MATCH_LAMBDA_START + (lambdas[1] - lambdas[0]) / 2.0;
            else if (i == numOfIntensities - 1)
                dl = (lambdas[i] - lambdas[i - 1]) / 2.0 + (COLOR_MATCH_LAMBDA_END - lambdas[i]);
            else
                dl = (lambdas[i] - lambdas[i - 1]) / 2.0 + (lambdas[i + 1] - lambdas[i]) / 2.0;

            X += intensities[i] * x(lambdas[i]) * dl;
            Y += intensities[i] * y(lambdas[i]) * dl;
            Z += intensities[i] * z(lambdas[i]) * dl;
        }

        type r, g, b;
        r = XYZ_TO_ADOBE_RGB[0][0] * X + XYZ_TO_ADOBE_RGB[0][1] * Y + XYZ_TO_ADOBE_RGB[0][2] * Z;
        g = XYZ_TO_ADOBE_RGB[1][0] * X + XYZ_TO_ADOBE_RGB[1][1] * Y + XYZ_TO_ADOBE_RGB[1][2] * Z;
        b = XYZ_TO_ADOBE_RGB[2][0] * X + XYZ_TO_ADOBE_RGB[2][1] * Y + XYZ_TO_ADOBE_RGB[2][2] * Z;
        return color<type>(r, g, b);
    }

    struct rgb_intensities
    {
        double intensities[3];
        double lambdas[3];
    };

    template <class type>
    rgb_intensities IntensitiesFromRGB2(color<type> c)
    {
        rgb_intensities i;
        i.lambdas[0] = MODEL_RGB_WAVELENGTH[0];
        i.lambdas[1] = MODEL_RGB_WAVELENGTH[1];
        i.lambdas[2] = MODEL_RGB_WAVELENGTH[2];
        i.intensities[0] = c.B;
        i.intensities[1] = c.G;
        i.intensities[2] = c.R;
        return i;
    }


    double __determ3x3(double a11, double a12, double a13,
                       double a21, double a22, double a23,
                       double a31, double a32, double a33);

    template <class type>
    rgb_intensities IntensitiesFromRGB(color<type> c)
    {
        rgb_intensities i;
        i.lambdas[0] = MODEL_RGB_WAVELENGTH[0];
        i.lambdas[1] = MODEL_RGB_WAVELENGTH[1];
        i.lambdas[2] = MODEL_RGB_WAVELENGTH[2];
        double X = ADOBE_RGB_TO_XYZ[0][0] * c.R + ADOBE_RGB_TO_XYZ[0][1] * c.G + ADOBE_RGB_TO_XYZ[0][2] * c.B;
        double Y = ADOBE_RGB_TO_XYZ[1][0] * c.R + ADOBE_RGB_TO_XYZ[1][1] * c.G + ADOBE_RGB_TO_XYZ[1][2] * c.B;
        double Z = ADOBE_RGB_TO_XYZ[2][0] * c.R + ADOBE_RGB_TO_XYZ[2][1] * c.G + ADOBE_RGB_TO_XYZ[2][2] * c.B;
        double dlB = MODEL_RGB_WAVELENGTH[0] - COLOR_MATCH_LAMBDA_START + (MODEL_RGB_WAVELENGTH[1] - MODEL_RGB_WAVELENGTH[0]) / 2.0;
        double dlG = (MODEL_RGB_WAVELENGTH[1] - MODEL_RGB_WAVELENGTH[0]) / 2.0 + (MODEL_RGB_WAVELENGTH[2] - MODEL_RGB_WAVELENGTH[1]) / 2.0;
        double dlR = (MODEL_RGB_WAVELENGTH[2] - MODEL_RGB_WAVELENGTH[1]) / 2.0 + (COLOR_MATCH_LAMBDA_END - MODEL_RGB_WAVELENGTH[2]);
        double xb = x(MODEL_RGB_WAVELENGTH[0]), xg = x(MODEL_RGB_WAVELENGTH[1]), xr = x(MODEL_RGB_WAVELENGTH[2]);
        double yb = y(MODEL_RGB_WAVELENGTH[0]), yg = y(MODEL_RGB_WAVELENGTH[1]), yr = y(MODEL_RGB_WAVELENGTH[2]);
        double zb = z(MODEL_RGB_WAVELENGTH[0]), zg = z(MODEL_RGB_WAVELENGTH[1]), zr = z(MODEL_RGB_WAVELENGTH[2]);

        // kramer
        double d = __determ3x3(xb * dlB, xg * dlG, xr * dlR,
                               yb * dlB, yg * dlG, yr * dlR,
                               zb * dlB, zg * dlG, zr * dlR);

        i.intensities[0] = __determ3x3(X, xg * dlG, xr * dlR,
                                       Y, yg * dlG, yr * dlR,
                                       Z, zg * dlG, zr * dlR) / d;
        i.intensities[1] = __determ3x3(xb * dlB, X, xr * dlR,
                                       yb * dlB, Y, yr * dlR,
                                       zb * dlB, Z, zr * dlR) / d;

        i.intensities[2] = __determ3x3(xb * dlB, xg * dlG, X,
                                       yb * dlB, yg * dlG, Y,
                                       zb * dlB, zg * dlG, Z) / d;

        i.intensities[0] = i.intensities[0] < 0 ? 0 : i.intensities[0];
        i.intensities[1] = i.intensities[1] < 0 ? 0 : i.intensities[1];
        i.intensities[2] = i.intensities[2] < 0 ? 0 : i.intensities[2];
        return i;
    }

    template <class type>
    double LambdaIntencityFromRGB2(color<type> c, double l)
    {
        rgb_intensities i = IntensitiesFromRGB2(c);
        if (l < i.lambdas[0])
            return i.intensities[0];
        if (l < i.lambdas[1])
        {
            double d = (l - i.lambdas[0]) / (i.lambdas[1] - i.lambdas[0]);
            return (1.0 - d) * i.intensities[0] + d * i.intensities[1];
        }
        if (l < i.lambdas[2])
        {
            double d = (l - i.lambdas[1]) / (i.lambdas[2] - i.lambdas[1]);
            return (1.0 - d) * i.intensities[1] + d * i.intensities[2];
        }
        else
            return i.intensities[2];
    }

    template <class type>
    double LambdaIntencityFromRGB(color<type> c, double l)
    {
        rgb_intensities i = IntensitiesFromRGB(c);
        if (l < i.lambdas[0])
        {
            double d = (l - COLOR_MATCH_LAMBDA_START) / (i.lambdas[0] - COLOR_MATCH_LAMBDA_START);
            return d * i.intensities[0];
        }
        if (l < i.lambdas[1])
        {
            double d = (l - i.lambdas[0]) / (i.lambdas[1] - i.lambdas[0]);
            return (1.0 - d) * i.intensities[0] + d * i.intensities[1];
        }
        if (l < i.lambdas[2])
        {
            double d = (l - i.lambdas[1]) / (i.lambdas[2] - i.lambdas[1]);
            return (1.0 - d) * i.intensities[1] + d * i.intensities[2];
        }
        else
        {
            double d = (l - i.lambdas[2]) / (COLOR_MATCH_LAMBDA_END - i.lambdas[2]);
            return (1.0 - d) * i.intensities[2];
        }

    }



    template <class type>
    double Luminance(color<type> col)
    {
        return 0.2126 * col.R + 0.7152 * col.G + 0.0722 * col.B;
    }
}

#endif // !__COLOR_TABLE_H_



